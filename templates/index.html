{{ block "index" . }}
<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <style>
        #book.htmx-swapping {
            scale: 0;
            opacity: 0;
            transition: scale 1s cubic-bezier(.97,-0.28,.73,.78), opacity 1s ease-out;
        }
        .htmx-request .htmx-indicator {
            opacity:1
        }
        .svg-gray-400 {
            filter: invert(68%) sepia(8%) saturate(381%) hue-rotate(179deg) brightness(95%) contrast(87%);
        }
        </style>

        <script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/uno.global.js"></script>
        <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>
    </head>
    <body class="m-0 p-0 font-sans text-base bg-slate-800 text-slate-200">
        <header class="flex justify-center items-center h-20 shadow shadow-slate-900 bg-slate-700">
            <input type="search" name="q" placeholder="Beware of Chiken"
                class="w-10/12 md:w-64 h-8"
                hx-get="/search/"
                hx-trigger="keyup delay:200mx changed"
                hx-target="#shelfList"
                hx-indicator="#spinner">
            <div class="w-0 h-0 ml-2">
                <img id="spinner" class="relative bottom-3 animate-spin svg-gray-400 htmx-indicator" src="/static/icons/loader.svg" alt="loading indicator">
            </div>
        </header>

        <section class="flex flex-col md:flex-row gap-2 justify-center mt-4 mx-2">
            <main class="flex flex-col gap-2 order-2 md:order-1 w-11/12 md:w-3/4 lg:w-1/3 p-2">
                <form hx-post="/book/" hx-target="body" hx-trigger="submit"
                    class="flex flex-row flex-wrap gap-2 p-4 border-2 border-solid border-gray-700">
                    <div class="flex flex-col">
                        <label for="bookUrl">Url</label>
                        <input type="url" id="bookUrl" name="bookUrl" placeholder="https://archiveiofou..." required>
                    </div>
                    <div class="flex flex-col">
                        <label for="bookName">Name</label>
                        <input type="text" id="bookName" name="bookName" placeholder="Folklore Worm..." required>
                    </div>
                    <div class="flex flex-col">
                        <label for="bookChapter">Last Viewed Chapter</label>
                        <input type="number" id="bookChapter" name="bookChapter" placeholder="4" required>
                    </div>

                    <button class="w-10 ml-auto" type="submit"><img src="/static/icons/book-plus.svg" alt="Plus button svg"></button>
                </form>
                <h1>Shelf</h1>

                <section class="flex flex-col gap-2" id="shelfList">
                    {{ template "bookList" . }}
                </section>
            </main>

            <aside class="w-11/12 md:w-72 h-60 p-2 order-1 md:order-2 shadow shadow-slate-900 bg-slate-700">
                <h1>Recent Updates</h1>
                <p>I put in too much work for this thing so even though it's not going to be used I'll keep it</p>
            </aside>
        </section>
    </body>
</html>
{{ end }}


{{ block "bookList" . }}
{{ range .Results }}
{{ block "book" . }}
<div id="book" class="flex items-center p-2 shadow shadow shadow-slate-900 bg-slate-700">
    <a class="text-gray-200 text-lg font-semibold no-underline my-4"
        href="{{ .Url }}">
        {{ .Name }}
    </a>

    <h2 class="text-gray-500 text-3xl my-0 ml-auto">{{ .CurrentChapter }}</h2>

    <div class="flex flex-col gap-1 ml-4">
        <button class="h-8"
            hx-get="/book/{{ .Id }}/edit"
            hx-target="closest #book">
            <img src="/static/icons/pencil.svg" alt="Edit icon">
        </button>
        <button class="h-8"
            hx-delete="/book/{{ .Id }}/"
            hx-swap="delete swap:1s"
            hx-target="closest #book"
            hx-confirm="Are you sure you want to delete this book">
            <img src="/static/icons/trash.svg" alt="Delete icon">
        </button>
    </div>
</div>
{{ end }}
{{ end }}
{{ end }}


{{ block "bookEdit" . }}
<form hx-patch="/book/{{ .Id }}/" hx-target="body" hx-trigger="submit">
    <label for="bookUrl">Url</label>
    <input type="url" id="bookUrl" name="bookUrl" value="{{ .Url }}" required>
    <label for="bookName">Name</label>
    <input type="text" id="bookName" name="bookName" value="{{ .Name }}" required>
    <label for="bookChapter">Last Viewed Chapter</label>
    <input type="number" id="bookChapter" name="bookChapter" value="{{ .CurrentChapter }}" required>

    <button type="submit">Edit</button>
</form>
{{ end }}
